---
title: "PROYECTO 1"
author: "Grupo 4"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(haven)
library(janitor)
library(fs)
```


```{r}
unir_spss <- function(ruta_carpeta) {
  

  archivos <- dir_ls(ruta_carpeta, glob = "*.sav")
  
  if(length(archivos) == 0) {
    stop("¡Error! No encontré ningún archivo .sav en esa carpeta.")
  }
  
  message(paste("Se encontraron", length(archivos), "archivos. Iniciando unión segura..."))
  

  leer_y_normalizar <- function(archivo) {

    message(paste("  -> Procesando:", path_file(archivo)))
    
    read_sav(archivo) %>%

      clean_names() %>% 

      zap_labels() %>% 

      mutate(across(everything(), as.character))
  }
  

  df_unido <- map_dfr(archivos, leer_y_normalizar, .id = "origen_archivo")
  
  message("Unión completada. Restaurando tipos de datos...")
  
  #
  df_final <- df_unido %>%
    type_convert(col_types = cols()) 
    
  return(df_final)
}
```

```{r}
df_defunciones <- unir_spss("./Defunciones")
```


