---
title: "PROYECTO 1"
author: "Grupo 4"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(haven)
library(janitor)
library(fs)
library(ggplot2)
library(labelled)
library(knitr)
```


```{r}
unir_spss <- function(ruta_carpeta) {
  

  archivos <- dir_ls(ruta_carpeta, glob = "*.sav")
  
  if(length(archivos) == 0) {
    stop("¡Error! No encontré ningún archivo .sav en esa carpeta.")
  }
  
  message(paste("Se encontraron", length(archivos), "archivos. Iniciando unión segura..."))
  

  leer_y_normalizar <- function(archivo) {

    message(paste("  -> Procesando:", path_file(archivo)))
    
    read_sav(archivo) %>%

      clean_names() %>% 

      zap_labels() %>% 

      mutate(across(everything(), as.character))
  }
  

  df_unido <- map_dfr(archivos, leer_y_normalizar, .id = "origen_archivo")
  
  message("Unión completada. Restaurando tipos de datos...")
  
  #
  df_final <- df_unido %>%
    type_convert(col_types = cols()) 
    
  return(df_final)
}
```

```{r}
df_defunciones <- unir_spss("./Defunciones")
```

# Avances del proyecto 1

## Descripción General del conjunto de datos.

### Cantidad de variables y observaciones
```{r dimensiones_del_conjunto_de_datos}
# Numero de filas y columnas
total_observaciones <- nrow(df_defunciones)
total_variables <- ncol(df_defunciones)

cat("Cantidad de Observaciones (Filas):", format(total_observaciones, big.mark=","), "\n")
cat("Cantidad de Variables (Columnas):", total_variables, "\n")
```
El conjunto de datos consolidado, que abarca el período de 2012 a 2022, presenta una estructura robusta para el análisis de minería. Se identificaron un total de 950,793 observaciones; cada fila representa un registro único de defunción procesado por el INE, lo que constituye un volumen de datos estadísticamente significativo para detectar patrones de mortalidad a nivel nacional. En cuanto a la dimensionalidad, el dataset cuenta con 32 variables (columnas). Estos atributos contienen la información multidimensional de cada suceso, integrando datos geográficos, demográficos y médicos necesarios para la segmentación y el modelado predictivo.


### Significado y tipo de cada una de las variables
```{r Significado_y_tipo_de_cada_una_de_las_variables}
# Cargar metadatos originales (usar el primer archivo .sav como referencia)
archivo_ref <- dir_ls("./Defunciones", glob = "*.sav")[1]
datos_ref <- read_sav(archivo_ref) %>% janitor::clean_names()
etiquetas <- var_label(datos_ref)

# Definir lógica para el "Tipo de Variable" (Para que no salga todo como 'texto')
obtener_tipo_real <- function(nombre_var) {
  if (str_detect(nombre_var, "^(edad|anio|mes|dia|cant|total)")) {
    return("Numérico (Discreto)")
  } else if (str_detect(nombre_var, "^(fecha)")) {
    return("Fecha")
  } else {
    return("Categórico (Nominal)")
  }
}

# 3. Crear la Tabla Maestra
tabla_diccionario <- tibble(
  Variable = names(df_defunciones)
) %>%
  mutate(
    # A. Obtener el significado original
    Significado = map_chr(Variable, function(x) {
      lbl <- etiquetas[[x]]
      if (is.null(lbl)) return("Variable de Control / ID") else return(as.character(lbl))
    }),
    
    # B. Definir el tipo de dato lógico para el reporte
    Tipo_Variable = map_chr(Variable, obtener_tipo_real)
  ) %>%
  select(Variable, Tipo_Variable, Significado)

# 4. Mostrar la tabla
kable(tabla_diccionario, 
      caption = "Tabla 1: Diccionario de Variables (Significado y Tipología)",
      align = "l")
```

La tabla anterior presenta la estructura semántica del conjunto de datos consolidado, detallando las 32 variables disponibles tras la extracción de metadatos de los archivos fuente (.sav). Se observa una predominancia de variables categóricas nominales (como sexo, caudef y códigos geográficos) que permitirán la segmentación de la población, complementadas por variables numéricas discretas (como edadif y fechas de ocurrencia) esenciales para el análisis de distribuciones y series temporales. Esta caracterización valida que se cuenta con los atributos demográficos y médicos necesarios.